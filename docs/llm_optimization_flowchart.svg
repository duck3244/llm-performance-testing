<?xml version="1.0" encoding="UTF-8"?>
<svg width="1400" height="1200" xmlns="http://www.w3.org/2000/svg">
  <!-- 배경 -->
  <rect width="1400" height="1200" fill="#f8f9fa"/>
  
  <!-- 제목 -->
  <text x="700" y="30" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#2c3e50">
    LLM 최적화 시스템 - 플로우 다이어그램
  </text>
  
  <!-- 시작점 -->
  <ellipse cx="700" cy="80" rx="60" ry="30" fill="#2ecc71" stroke="#27ae60" stroke-width="2"/>
  <text x="700" y="88" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="white" font-weight="bold">
    시작
  </text>
  
  <!-- 1. CLI 초기화 -->
  <rect x="600" y="130" width="200" height="60" fill="#3498db" stroke="#2980b9" stroke-width="2" rx="10"/>
  <text x="700" y="155" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white" font-weight="bold">
    CLI 시스템 초기화
  </text>
  <text x="700" y="175" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">
    환경변수 설정, 로깅 초기화
  </text>
  
  <!-- 2. 싱글톤 매니저 생성 -->
  <rect x="600" y="220" width="200" height="60" fill="#9b59b6" stroke="#8e44ad" stroke-width="2" rx="10"/>
  <text x="700" y="245" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white" font-weight="bold">
    핵심 매니저 초기화
  </text>
  <text x="700" y="265" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">
    Resource, Async, Error 매니저
  </text>
  
  <!-- 3. 명령어 파싱 -->
  <polygon points="650,320 750,320 775,350 750,380 650,380 625,350" fill="#e67e22" stroke="#d35400" stroke-width="2"/>
  <text x="700" y="345" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white" font-weight="bold">
    명령어 파싱
  </text>
  <text x="700" y="365" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">
    argparse
  </text>
  
  <!-- 명령어별 분기 -->
  <!-- init 명령어 -->
  <rect x="50" y="450" width="160" height="80" fill="#1abc9c" stroke="#16a085" stroke-width="2" rx="10"/>
  <text x="130" y="475" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white" font-weight="bold">
    init 명령어
  </text>
  <text x="130" y="495" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">
    시스템 초기화
  </text>
  <text x="130" y="510" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">
    하드웨어 감지
  </text>
  <text x="130" y="525" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">
    모델 설정 생성
  </text>
  
  <!-- optimize 명령어 -->
  <rect x="240" y="450" width="160" height="80" fill="#e74c3c" stroke="#c0392b" stroke-width="2" rx="10"/>
  <text x="320" y="475" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white" font-weight="bold">
    optimize 명령어
  </text>
  <text x="320" y="495" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">
    파라미터 최적화
  </text>
  <text x="320" y="510" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">
    Optuna/Grid Search
  </text>
  
  <!-- benchmark 명령어 -->
  <rect x="430" y="450" width="160" height="80" fill="#f39c12" stroke="#e67e22" stroke-width="2" rx="10"/>
  <text x="510" y="475" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white" font-weight="bold">
    benchmark 명령어
  </text>
  <text x="510" y="495" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">
    성능 측정
  </text>
  <text x="510" y="510" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">
    속도, 정확도, 메모리
  </text>
  
  <!-- compare 명령어 -->
  <rect x="620" y="450" width="160" height="80" fill="#9b59b6" stroke="#8e44ad" stroke-width="2" rx="10"/>
  <text x="700" y="475" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white" font-weight="bold">
    compare 명령어
  </text>
  <text x="700" y="495" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">
    모델 비교
  </text>
  <text x="700" y="510" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">
    다중 모델 분석
  </text>
  
  <!-- status 명령어 -->
  <rect x="810" y="450" width="160" height="80" fill="#34495e" stroke="#2c3e50" stroke-width="2" rx="10"/>
  <text x="890" y="475" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white" font-weight="bold">
    status 명령어
  </text>
  <text x="890" y="495" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">
    시스템 상태 확인
  </text>
  <text x="890" y="510" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">
    메모리, 활성 작업
  </text>
  
  <!-- clean 명령어 -->
  <rect x="1000" y="450" width="160" height="80" fill="#95a5a6" stroke="#7f8c8d" stroke-width="2" rx="10"/>
  <text x="1080" y="475" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white" font-weight="bold">
    clean 명령어
  </text>
  <text x="1080" y="495" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">
    시스템 정리
  </text>
  <text x="1080" y="510" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">
    캐시, 메모리 정리
  </text>
  
  <!-- optimize 명령어 상세 플로우 -->
  <text x="320" y="580" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#2c3e50" font-weight="bold">
    Optimize 명령어 상세 플로우
  </text>
  
  <!-- 시스템 요구사항 확인 -->
  <polygon points="270,600 370,600 395,630 370,660 270,660 245,630" fill="#e67e22" stroke="#d35400" stroke-width="2"/>
  <text x="320" y="625" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white" font-weight="bold">
    시스템 요구사항
  </text>
  <text x="320" y="645" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">
    확인
  </text>
  
  <!-- 안전 모드 분기 -->
  <polygon points="70,700 170,700 195,730 170,760 70,760 45,730" fill="#27ae60" stroke="#2ecc71" stroke-width="2"/>
  <text x="120" y="725" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white" font-weight="bold">
    안전 모드?
  </text>
  <text x="120" y="745" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">
    --safe
  </text>
  
  <polygon points="470,700 570,700 595,730 570,760 470,760 445,730" fill="#e74c3c" stroke="#c0392b" stroke-width="2"/>
  <text x="520" y="725" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white" font-weight="bold">
    일반 모드
  </text>
  <text x="520" y="745" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">
    full power
  </text>
  
  <!-- 모델 설정 로드 -->
  <rect x="240" y="800" width="160" height="60" fill="#3498db" stroke="#2980b9" stroke-width="2" rx="10"/>
  <text x="320" y="825" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white" font-weight="bold">
    모델 설정 로드
  </text>
  <text x="320" y="845" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">
    ModelConfigManager
  </text>
  
  <!-- 메모리 안전성 확인 -->
  <polygon points="270,900 370,900 395,930 370,960 270,960 245,930" fill="#f39c12" stroke="#e67e22" stroke-width="2"/>
  <text x="320" y="925" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white" font-weight="bold">
    메모리 안전성
  </text>
  <text x="320" y="945" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">
    확인
  </text>
  
  <!-- 최적화 실행 -->
  <rect x="240" y="1000" width="160" height="60" fill="#9b59b6" stroke="#8e44ad" stroke-width="2" rx="10"/>
  <text x="320" y="1025" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white" font-weight="bold">
    최적화 실행
  </text>
  <text x="320" y="1045" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">
    SafeOptimizer
  </text>
  
  <!-- 결과 저장 -->
  <rect x="240" y="1100" width="160" height="60" fill="#1abc9c" stroke="#16a085" stroke-width="2" rx="10"/>
  <text x="320" y="1125" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white" font-weight="bold">
    결과 저장
  </text>
  <text x="320" y="1145" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">
    JSON 파일
  </text>
  
  <!-- 오른쪽 영역: 핵심 시스템 프로세스 -->
  <text x="900" y="580" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#2c3e50" font-weight="bold">
    핵심 시스템 프로세스
  </text>
  
  <!-- 메모리 관리 프로세스 -->
  <rect x="600" y="600" width="180" height="100" fill="#27ae60" stroke="#229954" stroke-width="2" rx="10"/>
  <text x="690" y="620" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white" font-weight="bold">
    메모리 관리 프로세스
  </text>
  <text x="610" y="640" font-family="Arial, sans-serif" font-size="9" fill="white">
    1. 모델 등록 (Weak Ref)
  </text>
  <text x="610" y="655" font-family="Arial, sans-serif" font-size="9" fill="white">
    2. 실시간 모니터링
  </text>
  <text x="610" y="670" font-family="Arial, sans-serif" font-size="9" fill="white">
    3. 임계값 확인
  </text>
  <text x="610" y="685" font-family="Arial, sans-serif" font-size="9" fill="white">
    4. 자동 정리
  </text>
  
  <!-- 비동기 작업 프로세스 -->
  <rect x="800" y="600" width="180" height="100" fill="#3498db" stroke="#2980b9" stroke-width="2" rx="10"/>
  <text x="890" y="620" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white" font-weight="bold">
    비동기 작업 프로세스
  </text>
  <text x="810" y="640" font-family="Arial, sans-serif" font-size="9" fill="white">
    1. 전용 이벤트 루프
  </text>
  <text x="810" y="655" font-family="Arial, sans-serif" font-size="9" fill="white">
    2. 태스크 큐 관리
  </text>
  <text x="810" y="670" font-family="Arial, sans-serif" font-size="9" fill="white">
    3. 스레드 안전 실행
  </text>
  <text x="810" y="685" font-family="Arial, sans-serif" font-size="9" fill="white">
    4. 결과 수집
  </text>
  
  <!-- 오류 처리 프로세스 -->
  <rect x="1000" y="600" width="180" height="100" fill="#e74c3c" stroke="#c0392b" stroke-width="2" rx="10"/>
  <text x="1090" y="620" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white" font-weight="bold">
    오류 처리 프로세스
  </text>
  <text x="1010" y="640" font-family="Arial, sans-serif" font-size="9" fill="white">
    1. 예외 포착
  </text>
  <text x="1010" y="655" font-family="Arial, sans-serif" font-size="9" fill="white">
    2. 패턴 매칭
  </text>
  <text x="1010" y="670" font-family="Arial, sans-serif" font-size="9" fill="white">
    3. 자동 복구 시도
  </text>
  <text x="1010" y="685" font-family="Arial, sans-serif" font-size="9" fill="white">
    4. 해결책 제시
  </text>
  
  <!-- 최적화 상세 프로세스 -->
  <rect x="700" y="750" width="300" height="120" fill="#9b59b6" stroke="#8e44ad" stroke-width="2" rx="10"/>
  <text x="850" y="770" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white" font-weight="bold">
    Optuna 최적화 상세 프로세스
  </text>
  <text x="710" y="790" font-family="Arial, sans-serif" font-size="9" fill="white">
    1. Study 생성 (TPE Sampler + Median Pruner)
  </text>
  <text x="710" y="805" font-family="Arial, sans-serif" font-size="9" fill="white">
    2. 파라미터 제안 (temperature, top_p, top_k, etc.)
  </text>
  <text x="710" y="820" font-family="Arial, sans-serif" font-size="9" fill="white">
    3. 목적 함수 실행 (평가자 호출)
  </text>
  <text x="710" y="835" font-family="Arial, sans-serif" font-size="9" fill="white">
    4. 성능 점수 수집
  </text>
  <text x="710" y="850" font-family="Arial, sans-serif" font-size="9" fill="white">
    5. 프루닝 결정 (조기 종료)
  </text>
  <text x="710" y="865" font-family="Arial, sans-serif" font-size="9" fill="white">
    6. 최적 파라미터 선택 및 추천사항 생성
  </text>
  
  <!-- 정리 및 종료 -->
  <rect x="1050" y="750" width="180" height="80" fill="#34495e" stroke="#2c3e50" stroke-width="2" rx="10"/>
  <text x="1140" y="775" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white" font-weight="bold">
    시스템 정리
  </text>
  <text x="1060" y="795" font-family="Arial, sans-serif" font-size="9" fill="white">
    1. 메모리 완전 해제
  </text>
  <text x="1060" y="810" font-family="Arial, sans-serif" font-size="9" fill="white">
    2. 태스크 정리
  </text>
  <text x="1060" y="825" font-family="Arial, sans-serif" font-size="9" fill="white">
    3. 리소스 해제
  </text>
  
  <!-- 메모리 안전성 분기 -->
  <polygon points="120,1000 220,1000 245,1030 220,1060 120,1060 95,1030" fill="#e74c3c" stroke="#c0392b" stroke-width="2"/>
  <text x="170" y="1025" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white" font-weight="bold">
    메모리 부족?
  </text>
  <text x="170" y="1045" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">
    OOM 위험
  </text>
  
  <!-- 긴급 정리 -->
  <rect x="50" y="1100" width="140" height="60" fill="#e67e22" stroke="#d35400" stroke-width="2" rx="10"/>
  <text x="120" y="1125" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="white" font-weight="bold">
    긴급 메모리 정리
  </text>
  <text x="120" y="1145" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">
    force cleanup
  </text>
  
  <!-- 종료점 -->
  <ellipse cx="700" cy="1180" rx="60" ry="30" fill="#e74c3c" stroke="#c0392b" stroke-width="2"/>
  <text x="700" y="1188" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="white" font-weight="bold">
    종료
  </text>
  
  <!-- 화살표 정의 -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#2c3e50"/>
    </marker>
  </defs>
  
  <!-- 메인 플로우 화살표들 -->
  <line x1="700" y1="110" x2="700" y2="130" stroke="#2c3e50" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="700" y1="190" x2="700" y2="220" stroke="#2c3e50" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="700" y1="280" x2="700" y2="320" stroke="#2c3e50" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- 명령어 분기 화살표들 -->
  <line x1="625" y1="350" x2="130" y2="450" stroke="#2c3e50" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="650" y1="350" x2="320" y2="450" stroke="#2c3e50" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="700" y1="380" x2="510" y2="450" stroke="#2c3e50" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="700" y1="380" x2="700" y2="450" stroke="#2c3e50" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="725" y1="350" x2="890" y2="450" stroke="#2c3e50" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="775" y1="350" x2="1080" y2="450" stroke="#2c3e50" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- optimize 상세 플로우 화살표들 -->
  <line x1="320" y1="530" x2="320" y2="600" stroke="#2c3e50" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="320" y1="660" x2="120" y2="700" stroke="#2c3e50" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="320" y1="660" x2="520" y2="700" stroke="#2c3e50" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="120" y1="760" x2="320" y2="800" stroke="#2c3e50" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="520" y1="760" x2="320" y2="800" stroke="#2c3e50" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="320" y1="860" x2="320" y2="900" stroke="#2c3e50" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="320" y1="960" x2="320" y2="1000" stroke="#2c3e50" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="320" y1="1060" x2="320" y2="1100" stroke="#2c3e50" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- 메모리 안전성 확인에서 분기 -->
  <line x1="245" y1="930" x2="170" y2="1000" stroke="#e74c3c" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="170" y1="1060" x2="120" y2="1100" stroke="#e74c3c" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="120" y1="1160" x2="320" y2="1160" stroke="#e67e22" stroke-width="2" stroke-dasharray="3,3" marker-end="url(#arrowhead)"/>
  
  <!-- 모든 명령어에서 정리로 -->
  <line x1="130" y1="530" x2="1140" y2="750" stroke="#7f8c8d" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrowhead)"/>
  <line x1="510" y1="530" x2="1140" y2="750" stroke="#7f8c8d" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrowhead)"/>
  <line x1="700" y1="530" x2="1140" y2="750" stroke="#7f8c8d" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrowhead)"/>
  <line x1="890" y1="530" x2="1140" y2="750" stroke="#7f8c8d" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrowhead)"/>
  <line x1="1080" y1="530" x2="1140" y2="750" stroke="#7f8c8d" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrowhead)"/>
  <line x1="320" y1="1160" x2="1140" y2="830" stroke="#7f8c8d" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrowhead)"/>
  
  <!-- 정리에서 종료로 -->
  <line x1="1140" y1="830" x2="700" y2="1150" stroke="#2c3e50" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- 조건부 분기 라벨 -->
  <text x="80" y="680" font-family="Arial, sans-serif" font-size="9" fill="#27ae60" font-weight="bold">예</text>
  <text x="450" y="680" font-family="Arial, sans-serif" font-size="9" fill="#e74c3c" font-weight="bold">아니오</text>
  <text x="200" y="980" font-family="Arial, sans-serif" font-size="9" fill="#e74c3c" font-weight="bold">예</text>
  <text x="350" y="920" font-family="Arial, sans-serif" font-size="9" fill="#27ae60" font-weight="bold">아니오</text>
</svg>